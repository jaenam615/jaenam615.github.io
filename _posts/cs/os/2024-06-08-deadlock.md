---
title: "교착 상태"
writer: James
date: 2024-06-08 15:18:00 +0900
categories: [cs, os]
tags: [cs, os]
pin: false
math: true
mermaid: true
image:
  path: https://github.com/jaenam615/jaenam615.github.io/assets/155196757/8a79a2ba-0312-4539-9467-28245cf2763a
---

## 정의
> 여러 개의 프로세스가 서로 상대방의 작업이 끝나기만 기다리고 있어 어느 쪽도 영원히 진행하지 못하는 상태  

## 교착상태와 기아상태의 차이

교착상태  
![deadlock](https://github.com/jaenam615/jaenam615.github.io/assets/155196757/8a79a2ba-0312-4539-9467-28245cf2763a)

- 영원히 멈춰있다  

기아상태  
![starvation](https://github.com/jaenam615/jaenam615.github.io/assets/155196757/5d48a58f-d76a-443f-8800-1020028f49ca)

- 언젠가는 시행될 가능성이 있다

## 교착상태의 특성

### 필요조건
- 상호배제
- 점유대기
- 비선점
- 환형대기 (순환대기)

> 네 가지 조건이 <b>동시에</b> 만족될 때 교착상태 발생 가능

#### 상호배제 (mutual exclusion)
- 프로세스가 자원에 대한 배타적인 통제권을 요구
- 적어도 하나 이상의 자원은 여러 프로세스에 의해 동시에 사용될 수 없음
- 다른 프로세스가 점유한 자원이 필요하면 반드시 대기

### 점유대기 (hold and wait)
- 프로세스가 이미 한 자원을 할당받아 점유하고 있는 상황에서 다른 프로세스가 점유하고 있는 또 다른 자원을 요구하여 해제되기를 기다리는 상황

### 비선점 (no preemption)
- 프로세스에 할당된 자원은 그 프로세스가 사용을 마치고 스스로 반환하기 전에는 해제되지 않음
- 할당된 자원은 타의에 의해서는 해제되지 않음

### 환형대기 (circular wait)
- 프로세스의 자원 점유 및 점유된 자원의 요구 관계가 환형을 이루며 대기하는 상황

## 자원할당 그래프 G = (V, E)

> V : 정점의 집합 V = P ∪ R
- P = {p1,p2,...,pn}: n개의 프로세스 
- R = {r1,r2,...,rm}: m개의 자원
> E : 방향 있는 간선의 집합 E = Q ∪ S
- Q = {(pi, rj): pi ∈ P, rj ∈ R}: 프로세스 pi가 자원 rj를 요구 
    요구간선 pi -> rj
- S = {(rj, pi): rj ∈ R, pi ∈ P}: 자원 rj가 프로세스 pi를 요구 
    할당간선 rj -> pi

![graph](https://jhi93.github.io/assets/img/os/ResourceAllocation.png)
*이미지 출처: 정해인님 기술 블로그 (HaeIn's Study Blog)*

위 그래프에서 pi에서 rj로 가는 방향 있는 간선은 프로세스가 자원을 요구하는 것이며,  
반대의 경우 자원이 프로세스에 할당되어 있다는 것이다.  

## 교착상태의 필요조건 표현 
상호배제: 하나의 할당간선  
점유대기: 한 프로세스에 할당간선과 요구간선 연결  
비선점: 요구간선  
환형대기: 사이크 (cycle)  

사이클 없음 : 교착상태 없음 (환형대기 조건 미발생)
사이클 있음 : 교착상태 발생 가능

## 교착상태의 처리기법
> 교착상태 예방
- 교착상태의 네 가지 필요조건이 동시에 만족되는 것을 피하며 교착상태가 발생하지 않도록 하는 방법

> 교착상태 회피
- 프로세스에 필요한 자원의 최대량에 대한 정보를 이용하여 교착상태가 발생하지 않도록 하는 방법

> 교착상태 탐지 및 복구
- 교착상태의 발생 여부를 조사하여 발생한 경우에는 적절한 조치를 취해 정상상태로 복구하는 방법 

### 교착상태 예방 

1. 상호배제 조건 제거

> 공유할 수 있는 자원: 상호배제 필요 없음
- 예: 읽기 전용 파일  

> 공유할 수 없는 자원: 반드시 상호배제 필요  
- 예: 프린터  
- 즉, 상호배제 조건 제거로 교착상태 예방은 불가능  

2. 점유대기 조건 제거

> 자원을 점유했을 때 대기하지 않아야 함 
- 프로세스가 앞으로 필요한 모든 자원을 처음에 한꺼번에 요구하여 할당받음
- 단, 자원이용률이 낮아지며 기아상태의 가능성이 있음

> 대기할 때 자원을 점유하고 있지 않아야 함
 

